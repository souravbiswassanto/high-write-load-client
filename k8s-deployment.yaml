apiVersion: v1
kind: Secret
metadata:
  name: postgres-credentials
  namespace: default
type: Opaque
stringData:
  DB_PASSWORD: "yourpassword"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: load-test-config
  namespace: default
data:
  DB_HOST: "postgres-service"
  DB_PORT: "5432"
  DB_USER: "postgres"
  DB_NAME: "testdb"
  DB_SSL_MODE: "disable"
  DB_MAX_OPEN_CONNS: "50"
  DB_MAX_IDLE_CONNS: "10"
  DB_MIN_FREE_CONNS: "5"
  CONCURRENT_WRITERS: "20"
  TEST_RUN_DURATION: "600"
  BATCH_SIZE: "200"
  REPORT_INTERVAL: "10"
  INSERT_PERCENT: "70"
  UPDATE_PERCENT: "30"
  TABLE_NAME: "load_test_data"
---
apiVersion: batch/v1
kind: Job
metadata:
  name: postgres-load-test
  namespace: default
spec:
  template:
    metadata:
      labels:
        app: postgres-load-test
    spec:
      containers:
      - name: load-client
        image: your-registry/high-write-load-client:latest
        imagePullPolicy: Always
        envFrom:
        - configMapRef:
            name: load-test-config
        - secretRef:
            name: postgres-credentials
        resources:
          limits:
            cpu: "2"
            memory: "2Gi"
          requests:
            cpu: "1"
            memory: "1Gi"
      restartPolicy: Never
  backoffLimit: 1
---
# Alternative: Run as a Deployment for continuous load testing
apiVersion: apps/v1
kind: Deployment
metadata:
  name: postgres-load-test
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: postgres-load-test
  template:
    metadata:
      labels:
        app: postgres-load-test
    spec:
      containers:
      - name: load-client
        image: your-registry/high-write-load-client:latest
        imagePullPolicy: Always
        envFrom:
        - configMapRef:
            name: load-test-config
        - secretRef:
            name: postgres-credentials
        resources:
          limits:
            cpu: "2"
            memory: "2Gi"
          requests:
            cpu: "1"
            memory: "1Gi"
